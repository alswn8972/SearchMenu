# PART3: 벡터 임베딩 + LLM 2단계 검색 시스템

## 📋 프로젝트 개요

PART3는 OpenAI API를 활용한 고급 메뉴 검색 시스템입니다. 벡터 임베딩과 LLM(Large Language Model)을 결합하여 2단계 검색을 수행하며, 사용자가 찾고자 하는 메뉴를 정확하고 빠르게 찾아줍니다.

## 🚀 주요 기능

### 1. 2단계 검색 시스템
- **1단계: 벡터 임베딩 검색**
  - OpenAI text-embedding-3-small 모델 사용
  - 의미적 유사성 기반 빠른 필터링
  - 키워드 매칭 우선 적용
  - 상위 20개 후보 선별

- **2단계: LLM 검색 결과 정교화**
  - GPT-3.5-turbo 모델 사용
  - 기능적 연관성, 용어 연관성 분석
  - 사용자 의도 파악
  - 최종 5개 결과 선별 및 순위 결정

### 2. 하이브리드 점수 시스템
- **벡터 점수**: 의미적 유사성 (0.0~1.0)
- **키워드 점수**: 직접적인 단어 매칭 (0.0~1.0)
- **LLM 연관도**: 지능형 매칭 점수 (0.0~1.0)
- **최종 점수**: 종합적인 연관성 평가

### 3. 캐시 시스템
- 임베딩 벡터를 로컬에 저장
- 재검색 시 API 호출 최소화
- 빠른 검색 속도 보장

### 4. 상세 정보 표시
- 페이지 이름 (메뉴명)
- 카테고리 정보
- 서비스 정보
- 계층 구조 (메뉴 구조)
- 연관성 이유 설명

## 📁 파일 구조

```
part3/
├── run_search.py              # 메인 실행 파일
├── vector_llm_search.py       # 2단계 검색 시스템 핵심
├── menu_data_loader.py        # 메뉴 데이터 로더
├── config.py                  # 설정 파일
├── requirements.txt           # 필요한 패키지 목록
├── ia-data.json              # 메뉴 데이터 파일
├── embeddings_cache.pkl       # 임베딩 캐시 파일
└── README.md                 # 프로젝트 설명서
```

## 🛠️ 설치 및 설정

### 1. 필요한 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. OpenAI API 키 설정
`.env` 파일을 생성하고 OpenAI API 키를 설정하세요:
```
OPENAI_API_KEY=your_api_key_here
```

### 3. 메뉴 데이터 확인
`ia-data.json` 파일이 올바른 위치에 있는지 확인하세요.

## 🚀 사용법

### 기본 실행
```bash
cd part3
python run_search.py
```

### 검색 예시
```
검색어를 입력하세요: 회원가입
검색어를 입력하세요: 결제
검색어를 입력하세요: 로그인
검색어를 입력하세요: 마이페이지
검색어를 입력하세요: 설정
```

## 📊 검색 결과 예시

```
🔍 '회원가입' 검색 결과:
============================================================

1. 📄 회원가입
   점수: 0.950
   카테고리: 회원
   서비스: 회원가입
   계층: 회원 > 회원가입
   이유: 검색어와 완전 일치

2. 📄 회원가입 완료
   점수: 0.850
   카테고리: 회원
   서비스: 회원가입
   계층: 회원 > 회원가입 > 완료
   이유: 회원가입 관련 기능

3. 📄 회원가입 약관동의
   점수: 0.800
   카테고리: 회원
   서비스: 회원가입
   계층: 회원 > 회원가입 > 약관동의
   이유: 회원가입 과정의 필수 단계
```

## 🔧 시스템 특징

### 1. 정확한 매칭
- **직접적인 단어 포함**: 검색어가 페이지명에 직접 포함
- **기능적 연관성**: 검색어와 페이지 기능이 실제로 연관
- **의미적 일치**: 검색어의 의미와 페이지 기능이 일치

### 2. 스마트 필터링
- 키워드 매칭 우선 적용
- 벡터 유사도 임계값 설정
- LLM 기반 지능형 필터링
- 결과가 없을 때 벡터 상위 5개 강제 출력

### 3. 성능 최적화
- 임베딩 캐시 시스템
- 검색 범위 제한 (500개)
- API 호출 최소화
- 빠른 응답 시간

## 🎯 검색 알고리즘

### 1단계: 벡터 임베딩 검색
1. 사용자 검색어를 벡터로 변환
2. 메뉴 데이터를 벡터로 변환
3. 키워드 매칭 점수 계산
4. 코사인 유사도 계산
5. 종합 점수로 상위 20개 후보 선별

### 2단계: LLM 정교화
1. 1단계 결과를 LLM에 전달
2. 기능적 연관성 분석
3. 사용자 의도 파악
4. 최종 5개 결과 선별
5. 연관성 이유 설명 생성

## 📈 성능 지표

- **검색 정확도**: 키워드 매칭 + 벡터 유사도 + LLM 분석
- **응답 속도**: 캐시 시스템으로 빠른 재검색
- **결과 품질**: 2단계 필터링으로 관련성 높은 결과만 출력
- **사용자 경험**: 상세한 정보와 연관성 이유 제공

## 🔍 검색 예시

| 검색어 | 예상 결과 |
|--------|-----------|
| 회원가입 | 회원가입, 회원가입 완료, 회원가입 약관동의 |
| 결제 | 결제, 결제내역, 결제수단 등록 |
| 로그인 | 로그인, 로그아웃, 자동로그인 설정 |
| 마이페이지 | 마이페이지, 개인정보 수정, 내 정보 |
| 설정 | 설정, 환경설정, 알림 설정 |

## 🚨 주의사항

1. **OpenAI API 키 필수**: 검색 기능 사용을 위해 OpenAI API 키가 필요합니다.
2. **인터넷 연결**: 벡터 임베딩과 LLM 호출을 위해 인터넷 연결이 필요합니다.
3. **API 비용**: OpenAI API 사용 시 비용이 발생할 수 있습니다.
4. **캐시 관리**: `embeddings_cache.pkl` 파일이 커질 수 있으므로 주기적으로 정리하세요.

## 🔄 업데이트 내역

- **v1.0**: 기본 벡터 검색 시스템
- **v2.0**: LLM 정교화 추가
- **v3.0**: 키워드 매칭 우선 적용
- **v4.0**: 강제 출력 시스템 추가
- **v5.0**: 상세 정보 표시 개선

## 📞 지원

문제가 발생하거나 개선 사항이 있으면 언제든 말씀해 주세요! 